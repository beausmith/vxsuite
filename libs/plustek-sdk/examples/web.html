<body>
  <span id="status"></span><br>
  <button onclick="scan()">Scan</button>
  <button onclick="accept()">Accept</button>
  <button onclick="reject({ hold: false })">Reject</button>
  <button onclick="reject({ hold: true })">Reject &amp; Hold</button>

  <br><br>

  <button onclick="scanContinuously()">Scan Continously</button>
  
  <div id="images"></div>
</body>
<script>
  const interval = setInterval(async () => {
    const response = await fetch('/status')
    document.getElementById('status').textContent = await response.text()
  }, 1000);

  async function scan() {
    const response = await fetch('/scan')
    const imageURLs = (await response.text()).split('\n')
    const images = document.getElementById('images')

    for (const imageURL of imageURLs) {
      const image = document.createElement('img')
      image.src = imageURL
      image.style.maxWidth = '600px'
      images.prepend(image)
    }
  }

  async function accept() {
    const response = await fetch('/accept')
    console.log(response.text())
  }

  async function reject({ hold }) {
    const response = await fetch(hold ? '/reject-hold' : '/reject')
    console.log(response.text())
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function scanContinuously() {
    while(true) {
      const response = await (await fetch('/status')).text()
      if (response == "PLKSS_ERRCODE_VTM_PS_READY_TO_SCAN") {
	const scanResponse = await fetch('/scan')
	const acceptResponse = await fetch('/accept')
      }

      await sleep(250)
    }
  }
</script>
